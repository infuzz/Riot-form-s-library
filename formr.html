<formr>
    <form name={props.id} onchange={validate}  oninput={validate}>
        <div each={ (field, i) in state.desc }>
            <div class="form-group" id="fgroup_{field.id || i}">
                <div is={'i'+callType(field.type)} field={field} attr={state.attr} index={i}></div>
            </div>
        </div>
    </form>    
	<script>
		export default {
			onBeforeMount() {
				this.state.desc = window.fields[this.props.id].desc
				this.state.attr = window.fields[this.props.id].attr
			},
            callType(type){
                let types=['textarea','date','color','datetime','datetime-local','email','month','number','tel','time','url','week']
                if(types.indexOf(type) > -1) return 'text'
                else return type
            },
			click() {
				this.fields.push({
					type: 'text',
					size: 10,
					value: 'First item'
				})
				this.update()
			},
            validate(ev){  
            	var invalidFeedback='<i class="text-danger fas fa-exclamation-triangle" aria-hidden="true"></i> '
                var validFeedback='<i class="text-success fas fa-check" aria-hidden="true"></i> '
                var feedBackElt=ev.target.closest(".form-group").querySelector(".inputFeedback")
                var field=ev.target
                var validity=ev.target.validity
                var isValid=validity.valid
                var msg=''
                //console.log(ev.target.validity) 
                //console.log(Object.keys(ev.target.validity))
                
                // Don't validate some
                if (field.disabled || field.type === 'file') return
                
                // If field is required and empty
                if (validity.valueMissing) msg+='Please fill out this field. '

                // If not the right type
                if (validity.typeMismatch) {
                    // Email
                    if (field.type === 'email') msg+= 'Please enter an email address. '
                    // URL
                    if (field.type === 'url') msg+= 'Please enter a URL. '
                }

                // If too short
                if (validity.tooShort) msg+= 'Please lengthen this text to ' + field.getAttribute('minLength') + ' characters or more. You are currently using ' + field.value.length + ' characters. '

                // If too long
                if (validity.tooLong) msg+= 'Please shorten this text to no more than ' + field.getAttribute('maxLength') + ' characters. You are currently using ' + field.value.length + ' characters. '

                // If number input isn't a number
                if (validity.badInput) msg+= 'Please enter a number. '

                // If a number value doesn't match the step interval
                if (validity.stepMismatch) msg+= 'Please select a valid value. '

                // If a number field is over the max
                if (validity.rangeOverflow) msg+= 'Please select a value that is no more than ' + field.getAttribute('max') + '. '

                // If a number field is below the min
                if (validity.rangeUnderflow) msg+= 'Please select a value that is no less than ' + field.getAttribute('min') + '. '

                // If pattern doesn't match
                if (validity.patternMismatch) {
                    // If pattern info is included, return custom error
                    if (field.hasAttribute('title')) msg+= field.getAttribute('title')
                    // Otherwise, generic error
                    msg+= 'Please match the requested format. '

                }

                // If all else fails, return a generic catchall error
                if(!isValid && !msg) msg= 'The value you entered for this field is invalid. ';

                feedBackElt.innerHTML=(isValid?validFeedback:invalidFeedback) +' ' +msg
               
                
                
                
                
            }
		}
	</script>
	<style>
         /*-- redefine some bootstrap style --*/
		.hide,
		.form-inline .hide {
			display: none;
		}
        .form-group
        {
            margin-bottom: 1.5rem; /*bottom margin after each field*/
        }
        

        label
        {
            font-size:1.1rem;
            font-weight: 500;
        }
        
        button:disabled
        {
          cursor: not-allowed;
        }
        button:focus, input:focus, textarea:focus { outline: none !important; border-color: #719ECE!important; box-shadow: 0 0 10px #719ECE!important; }
    </style>
</formr>
